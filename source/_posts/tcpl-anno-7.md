---
title: The C Programming Language - annotation, 7
tags:
  - c
  - language
  - programming
categories:
  - - c
    - language
  - - language
    - c
date: 2024-11-20 22:01:15
---

## Input and Output

输入/输出功能并不是C语言本身的组成部分。...标准库...输入/输出函数、字符串处理函数、存储管理函数与数学函数。

ANSI标准精确地定义了这些库函数，所以，在任何可以使用C语言的系统中都有这些函数的兼容形式。如果程序的系统交互部分仅仅使用了标准库提供的功能，则可以不经修改地从一个系统移植到另一个系统中。

## 1. 标准输入/输出

标准库实现了简单的文本输入/输出模式。文本流由一系列行组成，每一行的结尾是一个换行符。如果系统没有遵循这种模式，则标准库将通过一些措施使得该系统适应这种模式。例如，标准库可以在输入端将回车符和换页符都转化为换行符，而在输出端进行反向转换。

最简单的输入机制是使用`getchar`函数从**标准输入**中（一般为键盘）一次读取一个字符：

```c
int getchar(void)
```

`getchar`函数在每次被调用时返回下一个输入字符。若遇到文件结尾，则返回`EOF`。符号常量`EOF`在头文件`<stdio.h>`中定义，其值一般为-1，但程序中应该使用`EOF`来测试文件是否结束，这样才能保证程序同`EOF`的特定值无关。

在许多环境中，可以使用符号`<`来实现输入重定向，它将把键盘输入替换为文件输入：如果程序prog中使用了函数`getchar`，则命令行`prog <infile`将使得程序prog从输入文件infile（而不是从键盘）中读取字符。实际上，程序prog本身并不在意输入方式的改变，并且，字符串“<infile”也并不包含在`argv`的命令行参数中。如果输入通过管道机制来自于另一个程序，那么这种输入切换也是不可见的。比如，在某些系统中，下列命令行：`other prog | prog`将运行两个程序otherprog和prog，并将程序otherprog的标准输出通过管道重定向到程序prog的标准输入上。

函数

```c
int putchar(int)
```

用于输出数据。`putchar(c)`将字符c送至**标准输出**上，在默认情况下，标准输出为屏幕显示。如果没有发生错误，则函数`putchar`将返回输出的字符；如果发生了错误，则返回`EOF`。同样，通常情况下，也可以使用“>outfile”的格式将输出重定向到某个文件中。例如，如果程序prog调用了函数`putchar`，那么命令行`prog >outfile`将把程序prog的输出从标准输出设备重定向到文件中。如果系统支持管道，那么命令行`prog | anotherprog`将把程序prog的输出从标准输出通过管道重定向到程序anotherprog的标准输入中。

函数`printf`也向标准输出设备上输出数据。我们在程序中可以交叉调用函数`putchar`和`printf`，输出将按照函数调用的先后顺序依次产生。

使用输入/输出库函数的每个源程序文件必须在引用这些函数之前包含下列语句：`#include <stdio.h>`。当文件名用一对尖括号`<`和`>`括起来时，预处理将在由具体实现定义的有关位置中查找指定的文件（例如，在UNIX系统中，文件一般放在目录`/usr/include`中）。

许多程序只从一个输入流中读取数据，并且只向一个输出流中输出数据。对于这样的程序，只需要使用函数`getchar`、`putchar`和`printf`实现输入/输出即可，并且对程序来说已经足够了。特别是，如果通过重定向将一个程序的输出连接到另一个程序的输入，仅仅使用这些函数就足够了。

## 2. 格式化输出——`printf`函数

输出函数`printf`将内部数值转换为字符的形式。

```
int printf(char *format, arg1, arg2, ...)
```

函数`printf`在输出格式`format`的控制下，将其参数进行转换与格式化，并在标准输出设备上打印出来。它的返回值为打印的字符数。

格式字符串包含两种类型的对象：普通字符和转换说明。在输出时，普通字符将原样不动地复制到输出流中，而转换说明并不直接输出到输出流中，而是用于控制`printf`参数的转换和打印。每个转换说明都由一个百分号字符（即`%`）开始，并以一个转换字符结束。在字符`%`和转换字符中间可能依次包含下列组成部分：

- 负号，用于指定被转换的参数按照左对齐的形式输出。
- 数，用于指定最小字段宽度。转换后的参数将打印不小于最小字段宽度的字段。如果有必要，字段左边（如果使用左对齐的方式，则为右边）多余的字段位置用空格填充以保证最小字段宽。
- 小数点，用于将字段宽度和精度分开。
- 数，用于指定精度，即指定字符串中要打印的最大字符数、浮点数小数点后的位数、整数最少输出的数字数目。
- 字母`h`或`l`，字母`h`表示将整数作为`short`类型打印，字母`l`表示将整数作为`long`类型打印。

转换字符：

- d, i：`int`类型；十进制数
- o：`int`类型；无符号八进制数（没有前导`0`）
- x, X：`int`类型；无符号十六进制数（没有前导`0x`或`0X`），10~15分别用`abcdef`或`ABCDEF`表示
- u：`int`类型；无符号十进制数
- c：`int`类型；单个字符
- s：`char *`类型；顺序打印字符串中的字符，直到遇到`'\0'`或已打印了由精度指定的字符数为止
- f：`double`类型；十进制小数 [-]_m.dddddd_，其中 _d_ 的个数由精度指定（默认值为6）
- e, E：`double`类型；[-]_m.dddddd e/E+/-xx_，其中 _d_ 的个数由精度指定（默认值为6）
- g, G：`double`类型；如果指数小于-4或大于等于精度，则用`%e/E`格式输出，否则用`%f`格式输出。尾部的0和小数点不打印
- p：`void *`类型；指针（取决于具体实现）
- %：不转换参数；打印一个百分号`%`

如果`%`后面的字符不是一个转换说明，则该行为是未定义的。

在转换说明中，宽度或精度可以用星号`*`表示，这时，宽度或精度的值通过转换下一参数（必须为`int`类型）来计算。

注意：函数`printf`使用第一个参数判断后面参数的个数及类型。如果参数的个数不够或者类型错误，则将得到错误的结果。

函数`sprintf`执行的转换和函数`printf`相同，但它将输出保存到一个字符串中：

```
int sprintf(char *string, char *format, arg1, arg2, ...)
```

`sprintf`函数和`printf`函数一样，按照`format`格式格式化参数序列`arg1`、`arg2`、...，但它将输出结果存放到`string`中，而不是输出到标准输出中。当然，`string`必须足够大以存放输出结果。
