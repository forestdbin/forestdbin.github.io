---
title: The C Programming Language - annotation, 4
tags:
  - c
  - language
  - programming
categories:
  - - c
    - language
  - - language
    - c
date: 2024-09-03 22:19:58
---

## Function and Program Structure

函数可以把大的计算任务分解成若干个较小的任务，程序设计人员可以基于函数进一步构造程序，而不需要重新编写一些代码。一个设计得当的函数可以把程序中不需要了解的具体操作细节隐藏起来，从而使整个程序结构更加清晰，并降低修改程序的难度。

C语言在设计中考虑了函数的高效性与易用性这两个因素。C语言程序一般都由许多小的函数组成，而不是由少量较大的函数组成。一个程序可以保存在一个或者多个源文件中。各个文件可以单独编译，并可以与库中已编译过的函数一起加载。

ANSI标准对C语言所做的最明显的修改是函数声明与函数定义这两方面。目前C语言已经允许在声明函数时声明参数的类型。为了使函数的声明与定义相适应，ANSI标准对函数定义的语法也做了修改。基于该原因，编译器就有可能检测出比以前的C语言版本更多的错误。并且，如果参数声明得当，程序可以自动地进行适当的强制类型转换。

ANSI标准进一步明确了名字的作用域规则，特别要求每个外部对象只能有一个定义。初始化的适用范围也更加广泛了，自动数组与结构都可以进行初始化。

C语言预处理器的功能也得到了增强。新的预处理器包含一组更完整的条件编译指令（一种通过宏参数创建带引号的字符串的方法），对宏扩展过程的控制更严格。

## 1. 函数的基本知识

尽管我们可以把所有的代码都放在主程序`main`中，但更好的做法是，利用其结构把每一部分设计成一个独立的函数。分别处理3个小的部分比处理一个大的整体更容易，因为这样可以把不相关的细节隐藏在函数中，从而减少了不必要的相互影响的机会，并且，这些函数也可以在其他程序中使用。

函数的定义形式如下：

```c 函数的定义
返回值类型 函数名(参数声明表)
{
    声明和语句
}
```

函数定义中的各构成部分都可以省略。最简单的函数如下所示：

```
dummy() {}
```

该函数不执行任何操作也不返回任何值。这种不执行任何操作的函数有时很有用，它可以在程序开发期间用以保留位置（留待以后填充代码）。如果函数定义中省略了返回值类型，则默认为`int`类型。

程序可以看成是变量定义和函数定义的集合。函数之间的通信可以通过参数、函数返回值以及外部变量进行。函数在源文件中出现的次序可以是任意的。只要保证每一个函数不被分离到多个文件中，源程序就可以分成多个文件。

被调用函数通过`return`语句向调用者返回值，`return`语句的后面可以跟任何表达式：

```
return expression;
```

在必要时，**表达式**将被转换为函数的返回值类型。**表达式**两边通常加一对圆括号，此处的括号是可选的。

调用函数可以忽略返回值。并且，`return`语句的后面也不一定需要表达式。当`return`语句的后面没有表达式时，函数将不向调用者返回值。当被调用函数执行到最后的右花括号而结束执行时，控制同样也会返回给调用者（不返回值）。如果某个函数从一个地方返回时有返回值，而从另一个地方返回时没有返回值，该函数并不非法，但可能是一种出问题的征兆。在任何情况下，如果函数没有成功地返回一个值，则它的“值”肯定是无用的。

...主程序`main`返回了一个状态。该返回值可以在该程序的环境中使用。

在不同的系统中，保存在多个源文件中的C语言程序的编译与加载机制是不同的。

## 2. 返回非整型值的函数

首先，由于函数的返回值类型不是`int`，因此函数必须声明返回值的类型。返回值的类型名应放在函数名字之前。

其次，调用函数必须知道函数返回的是非整型值，这一点也是很重要的。为了达到该目的，一种方法是在调用函数中显式声明函数。

函数的声明与定义必须一致。如果函数与调用它的主函数`main`放在同一源文件中，并且类型不一致，编译器就会检测到该错误。但是，如果函数是单独编译的（这种可能性更大），这种不匹配的错误就无法检测出来，函数将返回`double`类型的值，而`main`函数却将返回值按照`int`类型处理，最后的结果值毫无意义。

根据前面有关函数的声明如何与定义保持一致的讨论，发生不匹配现象似乎很令人吃惊。其中的一个原因是，如果没有函数原型，则函数将在第一次出现的表达式中被隐式声明。如果先前没有声明过的一个名字出现在某个表达式中，并且其后紧跟一个左圆括号，那么上下文就会认为该名字是一个函数名字，该函数的返回值将被假定为`int`类型，但上下文并不对其参数作任何假设。并且，如果函数声明中不包含参数，那么编译程序也不会对函数的参数作任何假设，并会关闭所有的参数检查。对空参数表的这种特殊处理是为了使新的编译器能编译比较老的C语言程序。不过，在新编写的程序中这么做是不提倡的。如果函数带有参数，则要声明它们；如果没有参数，则使用`void`进行声明。

在下列形式的`return`语句中：

```c
return (expression);
```

其中，表达式的值在返回之前将被转换为函数的类型。这种操作可能会丢失信息，某些编译器可能会对此给出警告信息。在该函数中，由于采用了类型转换的方法显式表明了所要执行的转换操作，因此可以防止有关的警告信息。
